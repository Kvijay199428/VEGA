Below is a complete, production-grade response covering all four requested items, written as if this were going into an internal VEGA engineering design repository.
This is exact, opinionated, and implementation-ready.

1. Exact JNI Headers for VEGA (C++ ↔ Java)
1.1 Java Native Interface (VEGA Side)
Package Convention (STRICT)
com.vegatrader.nativecore

Java Interface (Stable ABI)
package com.vegatrader.nativecore;

public final class NativeMarketData {

    static {
        System.loadLibrary("vega_md_core");
    }

    // ---- Lifecycle ----
    public static native long openReplay(
            String basePath,
            int instrumentId,
            long fromEpochNs,
            long toEpochNs
    );

    public static native void closeReplay(long handle);

    // ---- Replay ----
    public static native boolean next(long handle);

    public static native long headerAddress(long handle);
    public static native long payloadAddress(long handle);

    // ---- Shared Memory ----
    public static native long attachSharedMemory(String name);
}

JNI Header (Generated, Frozen)
/* DO NOT EDIT — GENERATED ABI */

JNIEXPORT jlong JNICALL
Java_com_vegatrader_nativecore_NativeMarketData_openReplay(
    JNIEnv *, jclass, jstring, jint, jlong, jlong);

JNIEXPORT jboolean JNICALL
Java_com_vegatrader_nativecore_NativeMarketData_next(
    JNIEnv *, jclass, jlong);

JNIEXPORT jlong JNICALL
Java_com_vegatrader_nativecore_NativeMarketData_headerAddress(
    JNIEnv *, jclass, jlong);

JNIEXPORT jlong JNICALL
Java_com_vegatrader_nativecore_NativeMarketData_payloadAddress(
    JNIEnv *, jclass, jlong);

JNIEXPORT void JNICALL
Java_com_vegatrader_nativecore_NativeMarketData_closeReplay(
    JNIEnv *, jclass, jlong);

Critical JNI Rules

No objects returned

No arrays

Only long = raw pointer

ABI frozen forever

2. CMake + Maven Hybrid Build (Enterprise-Grade)
2.1 Repository Layout
VEGA/
├── backend/java/vega-trader
├── native/
│   ├── CMakeLists.txt
│   ├── include/
│   │   └── vega_md.h
│   └── src/
│       ├── journal.cpp
│       ├── replay.cpp
│       ├── shm_bus.cpp
│       └── jni_bridge.cpp

2.2 CMakeLists.txt (Native Core)
cmake_minimum_required(VERSION 3.22)
project(vega_md_core LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 20)
set(CMAKE_POSITION_INDEPENDENT_CODE ON)

find_package(JNI REQUIRED)

include_directories(
    ${JNI_INCLUDE_DIRS}
    include
)

add_library(vega_md_core SHARED
    src/journal.cpp
    src/replay.cpp
    src/shm_bus.cpp
    src/jni_bridge.cpp
)

set_target_properties(vega_md_core PROPERTIES
    OUTPUT_NAME "vega_md_core"
)


Build produces:

libvega_md_core.so
vega_md_core.dll

2.3 Maven Integration (pom.xml)
<plugin>
  <groupId>org.codehaus.mojo</groupId>
  <artifactId>exec-maven-plugin</artifactId>
  <version>3.1.0</version>
  <executions>
    <execution>
      <id>build-native</id>
      <phase>generate-resources</phase>
      <goals><goal>exec</goal></goals>
      <configuration>
        <executable>cmake</executable>
        <arguments>
          <argument>--build</argument>
          <argument>${project.basedir}/native/build</argument>
        </arguments>
      </configuration>
    </execution>
  </executions>
</plugin>

2.4 Runtime Linking
export LD_LIBRARY_PATH=$VEGA_HOME/native/build


or Windows:

$env:PATH += ";D:\VEGA\native\build"

3. Shared Memory Permission Model (Multi-User Safe)
3.1 Directory Layout (Mandatory)
/var/lib/vega/
├── marketdata_raw/
├── shm/
│   ├── md_feed.sock
│   ├── md_feed.shm
│   └── md_perm.json

3.2 POSIX Shared Memory Creation (C++)
int fd = shm_open(
    "/vega_md_feed",
    O_CREAT | O_RDWR,
    0660
);

ftruncate(fd, SHM_SIZE);


Ownership:

chown vega:trading /dev/shm/vega_md_feed
chmod 660 /dev/shm/vega_md_feed

3.3 Access Matrix
Role	Read	Write
Feed Handler	✅	✅
Replay Engine	✅	❌
UI / Strategy	✅	❌
Audit	✅	❌

No Java process ever writes shared memory.

4. SEBI-Grade Audit Replay Scripts
4.1 Audit Guarantees

SEBI requires:

Immutable records

Time-ordered

Replayable

No overwrite

Deterministic reproduction

Your RAW journal already satisfies this.

4.2 Audit Replay Tool (C++ CLI)
vega-md-audit \
  --instrument 61755 \
  --from 2025-05-23T09:15:00 \
  --to   2025-05-23T09:30:00 \
  --out audit_61755.csv

4.3 Output Schema
sequence,exchange_ts_ns,receive_ts_ns,bid1_price,bid1_qty,ask1_price,ask1_qty


Generated by:

fprintf(out,
 "%lu,%lu,%lu,%ld,%ld,%ld,%ld\n",
 hdr->sequence,
 hdr->exchange_ts_ns,
 hdr->receive_ts_ns,
 book->bids[0].price,
 book->bids[0].quantity,
 book->asks[0].price,
 book->asks[0].quantity
);

4.4 Regulatory Retention
Data	Retention
RAW Journals	7 years
Audit CSV	7 years
Replay Logs	2 years
5. RAW Market Data Storage Instructions (Critical)
5.1 Designated Storage Root
/var/lib/vega/marketdata_raw/


(Windows equivalent: D:\VEGA\marketdata_raw)

5.2 Directory Structure (MANDATORY)
marketdata_raw/
└── NSE_FO/
    └── 61755/
        ├── 2026-01-01_09.bin
        ├── 2026-01-01_10.bin
        └── 2026-01-01_11.bin


Rules

One instrument per directory

One file per hour

Append-only

Never delete intra-day

5.3 Write Flow
Upstox → Protobuf
      → Canonical Snapshot
      → C++ Journal Append
      → fsync (hourly)


No database.
No compression at write time.
No JSON.

Final Non-Negotiable Rules (VEGA RAW DATA LAW)

C++ owns truth

Java consumes truth

No object reconstruction

No protobuf storage

No GC in RAW path

All replay must be mmap

What I Can Do Next (Choose One)

Produce actual JNI + C++ source files

Implement MarketReplayEngine.cpp

Design latency matrix (exchange → NIC → Java)

Write FPGA feed adapter ABI

Provide SEBI audit certification checklist

Say “Proceed with X” and I will continue at the same depth.