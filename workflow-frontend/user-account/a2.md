Below is a complete, enterprise-grade continuation of the VEGA TRADER User / Account Page specification, covering all requested artifacts.
This is written as final implementation documentation suitable for engineering sign-off, security review, and production rollout.

VEGA TRADER
Advanced User / Account Page – Full Technical Specification
1. SSE-BASED REAL-TIME UPDATES (Authoritative)
1.1 Why SSE (Not WebSocket)
Reason	Justification
Direction	Server → Client only
Reliability	Auto-reconnect
Security	No bidirectional command risk
Simplicity	Stateless client

SSE is mandatory for auth state propagation.

1.2 SSE Endpoint
GET /auth/events
Content-Type: text/event-stream

1.3 Event Types
event: AUTH_STATE
event: TOKEN_PROGRESS
event: COOLDOWN
event: DB_RECOVERY
event: AUTH_CONFIRMED

1.4 Payload Examples
AUTH_STATE
{
  "state": "PARTIAL_AUTH",
  "primaryPresent": false
}

TOKEN_PROGRESS
{
  "total": 6,
  "generated": 3,
  "missing": ["PRIMARY"]
}

COOLDOWN
{
  "active": true,
  "remainingSeconds": 660
}

DB_RECOVERY
{
  "dbLocked": true,
  "fallback": "MEMORY",
  "autoRestart": true
}

AUTH_CONFIRMED
{
  "authenticated": true,
  "redirect": "/dashboard"
}

2. AUDIT LOG VIEWER (Bloomberg-Style)
2.1 Purpose

Transparent visibility into:

Authentication

Token lifecycle

DB recovery

Cooldown enforcement

2.2 Backend Endpoint
GET /audit/logs?limit=100

2.3 Log Model
Field	Description
timestamp	UTC
severity	INFO / WARN / ERROR
component	AUTH / DB / API
message	Human readable
correlationId	Session
2.4 UI Behavior

Scrollable grid

Auto-append newest

Severity color coding

No delete / edit

3. TOKEN EXPIRY TIMELINE (Critical Control)
3.1 Visual Concept
PRIMARY      |██████████████████| 22h 10m
WEBSOCKET_2 |█████████████████ | 21h 50m
OPTION_1    |██████████████████| 23h 05m

3.2 Backend Endpoint
GET /auth/tokens/expiry

3.3 Response
[
  {
    "apiName": "PRIMARY",
    "expiresAt": "2026-01-01T03:30:00",
    "remainingSeconds": 79800
  }
]

3.4 UI Rules

PRIMARY always pinned on top

Expiry < 1h → amber

Expiry < 10m → red

No refresh triggers allowed

4. MULTI-ACCOUNT SWITCHER
4.1 Purpose

Support:

Multiple broker accounts

Multiple API key sets

Isolated authentication state

4.2 Backend Endpoint
GET /accounts
POST /accounts/switch

4.3 Switch Contract
{
  "accountId": "UPSTOX_01"
}

4.4 Switch Rules

Clears memory cache

Reloads auth state

UI resets progress

Dashboard locked until confirmed

5. EXACT REST API SPECIFICATION (AUTH)
Endpoint	Method	Purpose
/auth/start	POST	Start login
/auth/status	GET	Current auth state
/auth/events	GET	SSE stream
/auth/tokens	GET	Token list
/auth/tokens/expiry	GET	Expiry timeline
/auth/ready	GET	Auth confirmed
/auth/logout	POST	Logout
/audit/logs	GET	Audit logs
6. UI WIREFRAME (Bloomberg-Style)
┌───────────────────────────────────────────────┐
│ VEGA TRADER │ USER / ACCOUNT                  │
├───────────────────────────────────────────────┤
│ Account ▼  | Client | Broker | Plan           │
├───────────────────────────────────────────────┤
│ AUTH STATE: PARTIAL (PRIMARY MISSING)         │
├───────────────────────────────────────────────┤
│ TOKEN PROGRESS     [███░░░░░] 3 / 6            │
│ - PRIMARY ❌                                     │
├───────────────────────────────────────────────┤
│ COOLDOWN TIMER: 10:58                          │
├───────────────────────────────────────────────┤
│ TOKEN EXPIRY TIMELINE                          │
├───────────────────────────────────────────────┤
│ SYSTEM HEALTH | DB ⚠ | API ✓ | CACHE ✓        │
├───────────────────────────────────────────────┤
│ AUDIT LOG (LIVE)                               │
├───────────────────────────────────────────────┤
│ [LOGOUT]      [GO TO DASHBOARD ⛔]              │
└───────────────────────────────────────────────┘

7. LOGIN & AUTH STATE MACHINE
7.1 States
IDLE
 ↓
LOGIN_STARTED
 ↓
TOKEN_GENERATION
 ↓
PARTIAL_AUTH
 ↓
COOLDOWN
 ↓
RESUME_GENERATION
 ↓
PRIMARY_VALIDATED
 ↓
AUTH_CONFIRMED
 ↓
DASHBOARD

7.2 Hard Rules

PRIMARY missing → cannot advance

Cooldown blocks generation

DB lock diverts to memory

AUTH_CONFIRMED is terminal gate

8. REACT IMPLEMENTATION (SKELETON)
useEffect(() => {
  const sse = new EventSource("/auth/events");

  sse.addEventListener("TOKEN_PROGRESS", e =>
    setProgress(JSON.parse(e.data))
  );

  sse.addEventListener("AUTH_CONFIRMED", () =>
    navigate("/dashboard")
  );

  return () => sse.close();
}, []);

9. JAVAFX IMPLEMENTATION (SSE)
HttpClient client = HttpClient.newHttpClient();

HttpRequest request = HttpRequest.newBuilder()
    .uri(URI.create("/auth/events"))
    .build();

client.sendAsync(request, BodyHandlers.ofLines())
    .thenAccept(lines ->
        lines.forEach(this::handleEvent)
    );

10. DATABASE LOCK FAILOVER POLICY (FINAL)
When SQLITE_BUSY occurs:

Token stored in memory cache

UI notified via SSE

Auto DB restart attempted

Backfill DB on recovery

Clear memory cache safely

11. SECURITY & COMPLIANCE NOTES

Tokens never shown

PRIMARY treated as root

Full audit trace

Deterministic auth

Zero false positives

12. FINAL GREEN-SIGNAL CHECKLIST

✔ SSE live updates
✔ No UI inference
✔ Cooldown enforced
✔ DB recovery automated
✔ PRIMARY hard gate
✔ Bloomberg-grade UX

FINAL STATEMENT

This design is:

Production-safe

Audit-ready

Scalable

Operator-friendly

Bloomberg-inspired, not copied