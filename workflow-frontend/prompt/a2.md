Below is the next, production-grade frontend module, continuing exactly from the Login Page, and strictly adhering to your constraints:

Fully respects the existing Java enterprise backend

No OAuth antipatterns

Bloomberg-style terminal UX

SEBI-audit safe

Uniform behavior across Web, CLI, automation

This section focuses on Post-Login Core Infrastructure, which every serious trading terminal implements before any charts or order books.

MODULE 2
Token Status, Session Control & Terminal Shell (Vite + React)

This is the control plane UI of Vega Trader.

1. Why This Module Comes Next (Critical Rationale)

In institutional terminals (Bloomberg / Refinitiv):

You do NOT land on charts after login.
You land on system readiness & entitlement validation.

Your backend already enforces this via:

Token lifecycle audits

Broker availability checks

Cooldown handling

Multi-API key orchestration

So the frontend must reflect backend truth, not assume success.

2. Architecture Overview
┌────────────┐
│ Login Page │
└─────┬──────┘
      │
      ▼
┌──────────────────────────┐
│ Session & Token Dashboard│  ← THIS MODULE
│ - Broker readiness       │
│ - Token expiry           │
│ - Health checks          │
│ - Audit visibility       │
└─────┬────────────────────┘
      │
      ▼
┌──────────────────────────┐
│ Terminal Shell Layout    │
│ (left nav, hotkeys, bus) │
└──────────────────────────┘


No trading UI is mounted until this module is GREEN.

3. Backend APIs Used (No New APIs Required)
3.1 Token Status
GET /api/auth/upstox/tokens/status

3.2 Broker Health (already planned in backend)
GET /api/broker/health

3.3 Audit Visibility (read-only)
GET /api/admin/actions/recent?limit=10


All read-only, SEBI safe.

4. Frontend State Model (Enterprise Grade)
SessionState
Field	Meaning
authStatus	LOGGED_OUT / LOGGING_IN / ACTIVE
brokerStatus	AVAILABLE / DEGRADED / DOWN
tokenValidity	Map<Broker, Status>
expiryWarnings	boolean
hardBlock	boolean

hardBlock = true → no trading UI allowed

5. Zustand Store (Session Controller)
src/store/sessionStore.ts
import { create } from "zustand";

export interface BrokerTokenStatus {
  valid: boolean;
  expiresAt: string;
}

interface SessionState {
  tokens: Record<string, BrokerTokenStatus>;
  brokerHealth: "UP" | "DEGRADED" | "DOWN";
  hardBlock: boolean;

  setTokens: (t: any) => void;
  setHealth: (h: SessionState["brokerHealth"]) => void;
}

export const useSessionStore = create<SessionState>((set) => ({
  tokens: {},
  brokerHealth: "DOWN",
  hardBlock: true,

  setTokens: (tokens) =>
    set({
      tokens,
      hardBlock: Object.values(tokens).some(t => !t.valid)
    }),

  setHealth: (health) =>
    set({
      brokerHealth: health,
      hardBlock: health === "DOWN"
    })
}));

6. Token Status Poller (Zero Assumptions)
src/services/sessionBootstrap.ts
import { fetchTokenStatus } from "../api/authApi";
import { useSessionStore } from "../store/sessionStore";

export const bootstrapSession = async () => {
  const { setTokens } = useSessionStore.getState();

  const res = await fetchTokenStatus();
  setTokens(res.data);
};


Runs on app start

Runs every 30–60 seconds

Backend is always the source of truth

7. Token Status Dashboard (Bloomberg-Style)
UI Principles

Dense

Status-first

No animations

Color = semantic only

TokenStatusPanel.tsx
import { useSessionStore } from "../store/sessionStore";

export function TokenStatusPanel() {
  const tokens = useSessionStore(s => s.tokens);

  return (
    <div className="bg-neutral-900 p-3 text-xs text-neutral-200">
      <h3 className="font-bold mb-2">BROKER TOKENS</h3>

      {Object.entries(tokens).map(([broker, t]) => (
        <div key={broker} className="flex justify-between">
          <span>{broker}</span>
          <span className={t.valid ? "text-green-400" : "text-red-500"}>
            {t.valid ? "ACTIVE" : "EXPIRED"}
          </span>
        </div>
      ))}
    </div>
  );
}

8. Terminal Shell Layout (Foundation for Everything)
Layout Rules (Institutional Standard)

Fixed left rail

No modals for critical info

Keyboard-first navigation

Deterministic rendering

TerminalShell.tsx
export function TerminalShell({ children }: any) {
  return (
    <div className="h-screen flex bg-black text-neutral-200">
      <aside className="w-60 border-r border-neutral-800">
        <TokenStatusPanel />
        {/* Later: Watchlists, Admin, Risk */}
      </aside>

      <main className="flex-1 overflow-hidden">
        {children}
      </main>
    </div>
  );
}

9. Hard-Block Enforcement (SEBI Safe)

No UI trickery.
If backend says NO, frontend obeys.

const hardBlock = useSessionStore(s => s.hardBlock);

if (hardBlock) {
  return (
    <div className="h-screen flex items-center justify-center text-red-500">
      SYSTEM NOT READY – TOKEN / BROKER ISSUE
    </div>
  );
}


This is audit-defensible behavior.

10. CLI & Automation Compatibility

Everything above maps 1:1 to CLI checks.

CLI equivalent
curl /api/auth/upstox/tokens/status


If invalid → block trading commands.

Same logic, different UI.

11. SEBI Audit Positioning

This module supports the following audit answers:

Q: Can users trade without valid broker tokens?
→ No. UI enforces backend readiness gates.

Q: Are token expiries visible to operators?
→ Yes, real-time dashboard.

Q: Is trading blocked during broker outage?
→ Yes, deterministic hard-block.

Q: Are credentials exposed client-side?
→ Never.

12. What This Unlocks Next

With this module complete, you can safely build:

Order Entry Panel

Order Book

Option Chain Grid

Advanced Greeks Surface

Latency Heatmaps

Audit Export UI

All without re-architecting.