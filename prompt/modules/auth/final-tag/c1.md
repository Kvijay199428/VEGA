Proceeding with the feature upgrade exactly as requested.
This is an enterprise-grade “Login Successful” confirmation layer that sits after token generation, confirms DB persistence, and visually presents Get Profile data in a clean, deterministic manner.

I will cover backend flow, API contracts, data guarantees, and frontend UI structure (React/Vite).

FEATURE: LOGIN SUCCESSFUL CONFIRMATION PAGE
Objective

After a successful Upstox login + token generation:

Confirm access token generated

Confirm access token persisted in DB

Fetch Get Profile API

Show visual confirmation page

Make it non-blocking, idempotent, and auditable

This page becomes the single source of truth that login is complete.

1. BACKEND FLOW (AUTHORITATIVE)
Updated Token Generation Lifecycle
Selenium Login
   ↓
Access Token Generated
   ↓
IMMEDIATE DB UPSERT (transactional)
   ↓
Get Profile API (using new token)
   ↓
Persist Profile Snapshot (optional)
   ↓
Return LoginSuccess DTO


No UI is shown unless all steps succeed.

2. DATABASE CONFIRMATION (MANDATORY)
Token Table (existing)
upstox_tokens
- api_name
- access_token
- expiry_at
- status
- created_at

Optional (Recommended): Profile Snapshot Table
upstox_profile_snapshot
- api_name
- user_id
- user_name
- email
- broker
- user_type
- exchanges
- products
- order_types
- poa
- ddpi
- is_active
- captured_at


This allows:

Audit

Debugging

Compliance exports

3. BACKEND DTOs (CLEAN CONTRACT)
Login Success Response DTO
public class LoginSuccessResponse {

    private boolean tokenInserted;
    private String apiName;
    private Instant tokenExpiry;

    private ProfileView profile;

    private String message; // human-readable
}

ProfileView DTO (Mapped from Get Profile)
public class ProfileView {

    private String userId;
    private String userName;
    private String email;
    private String broker;
    private String userType;

    private List<String> exchanges;
    private List<String> products;
    private List<String> orderTypes;

    private boolean poa;
    private boolean ddpi;
    private boolean isActive;
}

4. GET PROFILE SERVICE (POST-LOGIN ONLY)
public ProfileView fetchProfile(String accessToken) {

    GetProfileResponse response = upstoxApi.getProfile(accessToken);

    if (!response.getStatus().equals("success")) {
        throw new ProfileFetchException();
    }

    return mapper.toView(response.getData());
}


Rules

Never call profile before DB insert

Profile failure ≠ token failure

Token remains valid even if UI fails

5. REST ENDPOINT (FRONTEND ENTRY)
Endpoint
GET /api/auth/upstox/login-success/{apiName}

Response (Example)
{
  "tokenInserted": true,
  "apiName": "API_0",
  "tokenExpiry": "2025-01-01T15:30:00Z",
  "message": "Access token generated and stored successfully",
  "profile": {
    "email": "******",
    "exchanges": ["NSE", "NFO", "BSE", "CDS", "BFO", "BCD"],
    "products": ["D", "CO", "I"],
    "broker": "UPSTOX",
    "user_id": "******",
    "user_name": "******",
    "order_types": ["MARKET", "LIMIT", "SL", "SL-M"],
    "user_type": "individual",
    "poa": false,
    "ddpi": false,
    "is_active": true
  }
}


This endpoint is read-only and safe to refresh.

6. FRONTEND: LOGIN SUCCESS PAGE (VITE + REACT)
Page Purpose

Human confirmation

Operational clarity

No trading logic here

Zero mutation

Component Structure
LoginSuccessPage
 ├── StatusBanner
 ├── TokenInfoCard
 ├── ProfileInfoGrid
 └── ActionButtons

6.1 Status Banner (Top)

Green success banner

Icon: ✔

Text:
“Access Token Generated & Stored Successfully”

Optional subtext:

API Name

Timestamp

6.2 Token Info Card
Field	Value
API Name	API_0
Token Status	ACTIVE
Stored In DB	YES
Token Expiry	01 Jan 2025, 21:00 IST

Visual:

Badge: ACTIVE

DB icon with “Persisted”

6.3 Profile Info (Visual Grid)
Section: Account Information
Label	Value
User Name	******
User ID	******
Email	******
Broker	UPSTOX
User Type	Individual
Active	✅ Yes
Section: Permissions & Access
Exchanges
[NSE] [NFO] [BSE] [CDS] [BFO] [BCD]

Products
[Delivery] [Cover Order] [Intraday]

Order Types
[MARKET] [LIMIT] [SL] [SL-M]

Section: Account Flags
Flag	Status
POA	❌ Disabled
DDPI	❌ Disabled
6.4 Action Buttons

Proceed to Dashboard

Refresh Token Status

Logout / Close Session

No regenerate button here (by design).

7. FRONTEND DATA FLOW
useEffect(() => {
  fetch(`/api/auth/upstox/login-success/API_0`)
    .then(res => res.json())
    .then(setData);
}, []);


Page is:

Stateless

Refresh-safe

Read-only

8. FAILURE STATES (CLEAN UX)
Case	UI
Token not found	“Login incomplete”
Token expired	Redirect to login
Profile fetch failed	Token success shown + warning
API unreachable	Retry option

Token success is never hidden due to profile failure.

9. SECURITY CONSIDERATIONS

✔ Do not show raw access token
✔ Mask PII where needed
✔ No token regeneration here
✔ Read-only endpoint
✔ Rate-limited endpoint

10. FINAL RESULT

You now have:

A clear post-login success confirmation

Guaranteed DB persistence proof

A visual Get Profile dashboard

A safe UI boundary between auth and trading

Zero impact on token latency flow

This completes the auth lifecycle professionally.