# Token Persistence Implementation

## Phase 1: Database Layer
- [x] Create [ApiName](file:///d:/projects/VEGA%20TRADER/backend/java/vega-trader/src/main/java/com/vegatrader/upstox/auth/selenium/v2/exception/AuthException.java#42-45) enum (6 API types)
- [x] Create [UpstoxTokenEntity](file:///d:/projects/VEGA%20TRADER/backend/java/vega-trader/src/main/java/com/vegatrader/upstox/auth/db/entity/UpstoxTokenEntity.java#9-288) (exact schema mapping)
- [x] Create [SqliteDataSourceFactory](file:///d:/projects/VEGA%20TRADER/backend/java/vega-trader/src/main/java/com/vegatrader/upstox/auth/db/SqliteDataSourceFactory.java#17-76) (auto-detection)
- [x] Create [UpstoxTokenRepository](file:///d:/projects/VEGA%20TRADER/backend/java/vega-trader/src/main/java/com/vegatrader/upstox/auth/db/UpstoxTokenRepository.java#13-56) interface
- [x] Create [UpstoxTokenRepositoryImpl](file:///d:/projects/VEGA%20TRADER/backend/java/vega-trader/src/main/java/com/vegatrader/upstox/auth/db/UpstoxTokenRepositoryImpl.java#19-225) (REPLACE semantics)

## Phase 2: Validity Engine
- [x] Create [TokenValidityService](file:///d:/projects/VEGA%20TRADER/backend/java/vega-trader/src/main/java/com/vegatrader/upstox/auth/service/TokenValidityService.java#17-118) (time-based check)
- [x] Create [ProfileVerificationService](file:///d:/projects/VEGA%20TRADER/backend/java/vega-trader/src/main/java/com/vegatrader/upstox/auth/service/ProfileVerificationService.java#18-86) (API check)
- [x] Create [TokenDecisionReport](file:///d:/projects/VEGA%20TRADER/backend/java/vega-trader/src/main/java/com/vegatrader/upstox/auth/service/TokenDecisionReport.java#13-108) DTO
- [x] Create [TokenDecisionEngine](file:///d:/projects/VEGA%20TRADER/backend/java/vega-trader/src/main/java/com/vegatrader/upstox/auth/service/TokenDecisionEngine.java#22-124) (classify tokens)

## Phase 3: Integration
- [x] Create [UpstoxTokenMapper](file:///d:/projects/VEGA%20TRADER/backend/java/vega-trader/src/main/java/com/vegatrader/upstox/auth/service/UpstoxTokenMapper.java#17-117) (result â†’ entity)
- [x] Create [TokenGenerationService](file:///d:/projects/VEGA%20TRADER/backend/java/vega-trader/src/main/java/com/vegatrader/upstox/auth/service/TokenGenerationService.java#24-187) (orchestrator)
- [ ] Update [OAuthLoginAutomationV2](file:///d:/projects/VEGA%20TRADER/backend/java/vega-trader/src/main/java/com/vegatrader/upstox/auth/selenium/v2/OAuthLoginAutomationV2.java#34-346) to persist tokens (handled by TokenGenerationService)

## Phase 4: REST API
- [x] Create [TokenStatusController](file:///d:/projects/VEGA%20TRADER/backend/java/vega-trader/src/main/java/com/vegatrader/upstox/auth/controller/TokenStatusController.java#20-80) (GET /api/auth/upstox/tokens/status)
- [x] Create [TokenGenerationController](file:///d:/projects/VEGA%20TRADER/backend/java/vega-trader/src/main/java/com/vegatrader/upstox/auth/controller/TokenGenerationController.java#22-138) (POST /api/auth/upstox/tokens/generate)

## Phase 5: Testing
- [/] Compile and verify

