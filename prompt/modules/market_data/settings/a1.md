comprehensive implementation plan to expose MarketDataStreamerV3 settings for both CLI and Vite+React frontend, including subscription limits for normal and Upstox Plus users. I’ll break this down step by step.

1️⃣ Requirements Overview

Goals:

Provide a unified configuration for MarketDataStreamerV3.

Enforce connection and subscription limits per user category and tier.

Expose settings via:

CLI (JSON/YAML config or flags)

React frontend (REST API)

Allow dynamic updates without restarting the streamer (optional but recommended).

Limits Reference Table:

Normal Users:

Type	Category	Individual Limit	Combined Limit
Connection	–	2 connections/user	N/A
Subscription	LTPC	5000 keys	2000 keys
Subscription	Option Greeks	3000 keys	2000 keys
Subscription	Full	2000 keys	1500 keys

Upstox Plus:

Type	Category	Individual Limit	Combined Limit
Connection	–	5 connections/user	N/A
Subscription	Full D30	50 keys	1500 keys

Notes:

Individual Limit: max per category.

Combined Limit: max when subscribing to multiple categories.

2️⃣ Spring Boot Config Setup

Create a dedicated configuration class:

@Configuration
@ConfigurationProperties(prefix = "marketdata")
public class MarketDataSettings {

    private ConnectionLimits connectionLimits;
    private Map<String, SubscriptionLimit> subscriptionLimits = new HashMap<>();

    // Getters & Setters

    public static class ConnectionLimits {
        private int normal = 2;
        private int plus = 5;
        // Getters & Setters
    }

    public static class SubscriptionLimit {
        private int individual;
        private int combined;
        // Getters & Setters
    }
}


Populate via application.yml:

marketdata:
  connection-limits:
    normal: 2
    plus: 5
  subscription-limits:
    LTPC:
      individual: 5000
      combined: 2000
    OptionGreeks:
      individual: 3000
      combined: 2000
    Full:
      individual: 2000
      combined: 1500
    FullD30:
      individual: 50
      combined: 1500

3️⃣ Expose via REST API for React Frontend

Controller:

@RestController
@RequestMapping("/api/marketdata")
public class MarketDataSettingsController {

    private final MarketDataSettings settings;

    public MarketDataSettingsController(MarketDataSettings settings) {
        this.settings = settings;
    }

    @GetMapping("/settings")
    public ResponseEntity<MarketDataSettings> getSettings() {
        return ResponseEntity.ok(settings);
    }
}


React frontend can fetch: GET /api/marketdata/settings to render UI for category selection, limit indicators, etc.

4️⃣ CLI Access

Option 1: YAML/JSON config file

User provides settings.yml at runtime.

Load using Spring Boot @ConfigurationProperties + --spring.config.location=settings.yml.

Option 2: Command-line arguments

Example:

java -jar market-feeder.jar \
  --marketdata.connection-limits.normal=2 \
  --marketdata.subscription-limits.LTPC.individual=5000


Spring Boot automatically maps these to MarketDataSettings.

5️⃣ Enforce Limits in MarketDataStreamerV3

Modify subscription logic:

public void validateSubscription(String category, int requestedKeys) {
    SubscriptionLimit limit = settings.getSubscriptionLimits().get(category);
    if (limit == null) throw new IllegalArgumentException("Unknown category " + category);

    int maxAllowed = isPlusUser ? limit.getPlusCombined() : limit.getCombined();
    if (requestedKeys > maxAllowed) {
        throw new IllegalStateException(
            "Subscription exceeds allowed limit for category " + category
        );
    }
}


Enforce combined limits if multiple categories are selected:

int totalKeys = subscriptions.values().stream().mapToInt(List::size).sum();
if (totalKeys > combinedLimit) {
    throw new IllegalStateException("Combined subscription limit exceeded");
}

6️⃣ React Frontend Integration

Fetch limits: GET /api/marketdata/settings

Render subscription UI:

Display individual and combined limits dynamically

Disable categories or input when limits exceeded

Submit subscription request → backend validates before sending to WebSocket

Optional: Show tooltips/warnings if user exceeds normal limits but is on Plus.

7️⃣ CLI + Frontend Unified Flow
Action	CLI	Frontend (React)
Get current limits	Read settings.yml or args	GET /api/marketdata/settings
Validate subscription	In MarketDataStreamerV3	Backend endpoint enforces limits
Apply subscription	Direct WebSocket call	POST subscription → validated → WebSocket
Update limits dynamically	Reload config/YAML	API-driven config refresh
8️⃣ Recommended Enhancements

Dynamic Limit Reload: Refresh Spring @ConfigurationProperties at runtime for live updates.

User-Tier Awareness: Inject user tier (normal/plus) at login to enforce correct limits.

Metrics + Logging: Track:

Subscription attempts per category

Rejections due to limit violations

Number of active connections per user

Backpressure Compliance: Prevent subscribing to more instruments than buffer can handle.