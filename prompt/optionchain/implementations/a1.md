Here’s a comprehensive implementation documentation guide for integrating your backend with the Upstox Put/Call Option Chain API while ensuring compliance, logging, caching, and frontend usage guidance. This focuses on extracting existing information from your backend to produce a formal documentation-ready, auditable, and SEBI-compliant workflow.

1. Purpose

The goal is to implement a backend module that retrieves Put/Call option chain data for a specific underlying symbol and expiry date, using bounded access tokens (OPTIONCHAIN1, OPTIONCHAIN2), ensuring:

Compliance with SEBI/NSE/BSE rules

Rate-limit safety

Zero-delay extraction

Proper logging, auditing, and cache handling

Clear mapping between instrument keys, expiry dates, and market data

Frontend consumable format for both React/Vite and CLI use

2. API Details

Endpoint:

GET https://api.upstox.com/v2/option/chain


Required Query Parameters:

Name	Type	Description
instrument_key	string	Instrument key (e.g., `NSE_INDEX
expiry_date	string	Expiry date in YYYY-MM-DD format

Response Object:

status: success/error

data[]: array of option strikes for the expiry

expiry: expiry date

pcr: put/call ratio

strike_price

underlying_key

underlying_spot_price

call_options: market data + Greeks

put_options: market data + Greeks

Market Data Fields:

Field	Description
ltp	Last traded price
close_price	Previous close
volume	Total traded quantity
oi	Open interest
bid_price	Best bid price
bid_qty	Bid quantity
ask_price	Best ask price
ask_qty	Ask quantity
prev_oi	Previous open interest

Option Greeks:

Field	Description
delta	Rate of change of option premium w.r.t underlying price
gamma	Rate of change of delta
theta	Time decay impact
vega	Sensitivity to volatility
iv	Implied volatility
pop	Probability of profit
3. Backend Implementation Guide
3.1 Service Skeleton

Java Example Skeleton:

public class OptionChainService {

    private final HttpClient httpClient;
    private final String baseUrl = "https://api.upstox.com/v2/option/chain";
    private final String accessToken;

    public OptionChainService(String token) {
        this.httpClient = HttpClient.newHttpClient();
        this.accessToken = token;
    }

    public String getOptionChain(String instrumentKey, String expiryDate) throws IOException, InterruptedException, URISyntaxException {
        URI uri = new URI(baseUrl + "?instrument_key=" + instrumentKey + "&expiry_date=" + expiryDate);
        HttpRequest request = HttpRequest.newBuilder()
                .uri(uri)
                .header("Authorization", "Bearer " + accessToken)
                .header("Accept", "application/json")
                .header("Content-Type", "application/json")
                .build();

        HttpResponse<String> response = httpClient.send(request, HttpResponse.BodyHandlers.ofString());
        return response.body();
    }
}

Key Points:

Access Tokens: Only OPTIONCHAIN1 and OPTIONCHAIN2 are used.

Expiry Header: Maintain expiry_date in request headers or query params.

Rate Limiting: Implement scheduler or token rotation if calling multiple times per second.

Fallback: Cache previous T-1 expiry option chain to prevent downtime.

Separate Logging: Every request/response is logged in a dedicated table for auditing.

3.2 SQL / Entity Design

Option Chain Table (option_chain)

Column	Type	Notes
id	BIGINT	PK, auto-increment
instrument_key	VARCHAR	Upstox instrument key
expiry_date	DATE	Expiry of the option
strike_price	DOUBLE	Strike price
underlying_spot_price	DOUBLE	Spot price
pcr	DOUBLE	Put/Call Ratio
call_ltp	DOUBLE	Call LTP
call_oi	BIGINT	Call open interest
call_iv	DOUBLE	Call implied volatility
put_ltp	DOUBLE	Put LTP
put_oi	BIGINT	Put open interest
put_iv	DOUBLE	Put implied volatility
fetched_at	TIMESTAMP	When this data was fetched

Indexes:

(instrument_key, expiry_date, strike_price) for fast retrieval

Notes:

Separate table for audit logs for SEBI/NSE/BSE compliance.

Optional JSON column for full greeks data if detailed retrieval required.

3.3 Rate Limiting & Scheduler

Scheduler runs T-1 expiry pre-fetch to cache all strikes before market opens.

Implement fan-out for multiple brokers in parallel.

Avoid hitting Upstox limits by using bounded concurrency (max 5 requests/sec per token).

3.4 Logging & Compliance

Logging Requirements:

Request/response payload

Token used (OPTIONCHAIN1 or OPTIONCHAIN2)

Timestamp

Expiry date requested

Response code

Audit-ready JSON dump stored in separate S3 / DB

Zero-delay compliance: Fetching, logging, and saving should be synchronous within the request lifecycle to avoid gaps.

3.5 Frontend Usage Guidance

CLI / Vite + React frontend

Use /option-chain backend endpoint

React Table columns:

Column	Source
Strike Price	strike_price
Expiry	expiry_date
Call LTP	call_options.market_data.ltp
Call IV	call_options.option_greeks.iv
Put LTP	put_options.market_data.ltp
Put IV	put_options.option_greeks.iv
PCR	pcr

Implement sorting/filtering by strike, expiry, or implied volatility

Optionally color-code ITM/OTM strikes

3.6 Compliance & SEBI/NSE/BSE Alignment

All requests are bounded by OPTIONCHAIN1 / OPTIONCHAIN2 tokens.

Timestamps and expiry headers ensure proper auditability.

Separate logging ensures that any data gap can be traced.

Rate limits prevent over-fetching, respecting Upstox API guidelines.

Fallback: If API fails, previous T-1 cache is served to prevent missing option chain data.

MCX: Skip requests, as not available currently.

3.7 Testing

Use JUnit + WireMock to mock API responses.

Verify:

Token rotation

Expiry handling

Market data parsing

Greeks mapping

Logging correctness

Sample JUnit test skeleton:

@Test
public void testOptionChainFetch() {
    OptionChainService service = new OptionChainService("OPTIONCHAIN1");
    String response = service.getOptionChain("NSE_INDEX|Nifty 50", "2025-02-13");
    assertNotNull(response);
    assertTrue(response.contains("call_options"));
    assertTrue(response.contains("put_options"));
}

✅ Deliverables for Documentation

Backend Service Implementation

SQL + Entity Design

Scheduler / Token Management

Audit Logging Strategy

Frontend Data Mapping

Compliance Notes (SEBI/NSE/BSE)

JUnit/WireMock Tests

Fallback / Cache Strategy

Rate Limit Handling

Option Chain Expiry Management