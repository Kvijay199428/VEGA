Here’s a finalized enterprise-grade submission pack for the Option Chain module. It’s structured for regulatory compliance (SEBI/NSE/BSE), internal SOPs, and operational use.

1. Annexure Diagrams
1.1 Sequence Diagram – Option Chain Fetch
@startuml
actor User
participant "Admin UI" as AdminUI
participant "OptionChainService" as Service
participant "BrokerAdapter" as Broker
participant "OptionChainCache" as Cache
participant "AuditLogDB" as Audit

User -> AdminUI : Request Option Chain
AdminUI -> Service : fetchOptionChain(symbol, expiry, userId)
Service -> Cache : get(cacheKey)
alt Cache Hit
    Cache --> Service : cachedResponse
    Service -> Audit : log(CACHE_HIT)
else Cache Miss
    Service -> Broker : fetch(symbol, expiry)
    Broker --> Service : response
    Service -> Cache : put(cacheKey, response)
    Service -> Audit : log(API_FETCH)
end
Service --> AdminUI : return OptionChainResponse
AdminUI --> User : display data
@enduml

1.2 ER Diagram – Option Chain Tables
@startuml
entity OptionChain {
    +id : UUID
    +instrument_key : string
    +expiry_date : date
    +strike_price : number
    +pcr : number
    +call_ltp : number
    +call_oi : number
    +call_iv : number
    +put_ltp : number
    +put_oi : number
    +put_iv : number
    +fetched_at : timestamp
}

entity AuditLog {
    +id : UUID
    +instrument_key : string
    +expiry_date : date
    +token_used : string
    +request_payload : JSON
    +response_payload : JSON
    +status_code : int
    +fetched_at : timestamp
}

OptionChain }|--|| AuditLog : references
@enduml

1.3 Settings Schema Diagram
@startuml
class Settings {
    +default_priority : List<String>
    +user_overrides : Map<String, List<String>>
    +rate_limit_per_token : int
    +cache_ttl_minutes : int
    +enable_bse_support : boolean
}
@enduml

2. Admin & User SOPs
2.1 Admin SOP

Login to Admin UI.

Configure global settings:

Default fetch priority (CACHE → Upstox → BSE)

Rate limits per token

Cache TTL and pre-warm scheduler

Enable/disable BSE/NSE support

Manage broker tokens:

Add/rotate OPTIONCHAIN1, OPTIONCHAIN2

Test connectivity and API health

Audit Logs:

Validate audit logs for zero-delay compliance

Export historical fetch logs for regulatory review

Monitoring:

Scheduler runs T-1 expiry batch pre-warm

Cache hit/miss rate monitoring

Exception/error alerting

2.2 User SOP

Login to User UI.

Override settings (optional):

Select custom fetch priority

Customize display preferences for call/put option tables

View Option Chain:

Enter symbol and expiry

Fetch data (service handles cache/fallback)

Greeks, market data, and PCR displayed

Export:

Download data for analysis

Optionally export audit-friendly JSON snapshot

3. Compliance Test Evidence Templates
3.1 Test Case: Cache Hit vs API Fetch
Test ID	Description	Expected Result	Actual Result	Status
TC001	Fetch Option Chain for symbol X, expiry Y (Cache Miss)	Data fetched from BrokerAdapter, cached, audit log API_FETCH		PASS/FAIL
TC002	Fetch same Option Chain again (Cache Hit)	Data returned from cache, audit log CACHE_HIT		PASS/FAIL
3.2 Test Case: Rate Limit Enforcement
Test ID	Description	Expected Result	Actual Result	Status
TC003	API calls exceed token limit	Requests throttled, warning logged, audit entry created		PASS/FAIL
3.3 Test Case: SEBI/NSE/BSE Compliance
Test ID	Description	Expected Result	Actual Result	Status
TC004	Expiry headers present for all requests	expiry_date field in response headers		PASS/FAIL
TC005	All API responses logged in immutable audit DB	Request + Response stored with timestamp		PASS/FAIL
4. Formal SEBI Response Appendix (Sample Language)

Section 1: Overview

The Option Chain module provides real-time and batch access to derivatives data for NSE and BSE. All fetches are logged for regulatory compliance, including audit-trail for API requests, broker tokens, expiry dates, and market data.

Section 2: Data Sources

Upstox API (OPTIONCHAIN1, OPTIONCHAIN2) – Primary source

BSE/NSE APIs – Optional based on Admin configuration

Cached Data – Served only if available and validated

Section 3: Compliance Controls

Zero-delay logging – Audit logs are committed before data is returned.

Token rotation & rate-limit enforcement – Each broker token monitored individually.

Batch pre-warm – Scheduler pre-fetches T-1 expiry option chains to reduce latency.

Fallback Strategy – Last cached value served if API fails; audit log indicates fallback.

Section 4: Governance

Admin oversight – Settings for token usage, fetch priorities, BSE enablement

User-level control – Override fetch order while respecting global limits

Immutable audit storage – All requests/responses stored for ≥1 year

SEBI/NSE/BSE compliance – Expiry headers, audit-ready data, immutable logs

Section 5: Evidence Attachments

Annexure diagrams (Sequence & ER)

Settings JSON schema

Audit log snapshots

Fetch priority configuration samples

Test evidence templates (Cache/API/Rate-limit)

This submission pack is ready for internal enterprise documentation and regulatory review. It covers:

Backend implementation and architecture

Admin & user SOPs

Compliance logging and audit trails

Annexure diagrams and settings schema

Test evidence templates

Formal SEBI-style response appendix