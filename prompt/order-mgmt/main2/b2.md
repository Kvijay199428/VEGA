Below is an enterprise- and industry-grade implementation guide for the five read-side order & trade APIs:

Get Order History

Get Order Book

Get Trades

Get Order Trades

Get Trade History

The design is channel-agnostic (CLI, Vite+React, curl/REST), auditable, SEBI-aligned, and production-ready.

1. Architectural Positioning (Read-Side)

These APIs sit on the Post-Trade Read Plane and must be:

Non-blocking

Cache-aware

Auditable

Rate-governed

Deterministically replayable

Read Plane Layers
[ Client (CLI / Web / API) ]
        ↓
[ Read API Gateway ]
        ↓
[ Read Service Layer ]
        ↓
[ Cache (Redis / Caffeine) ]
        ↓
[ Order DB | Trade DB | Broker APIs ]

2. Common Enterprise Principles (Applies to All 5 APIs)
2.1 Data Sources Priority

In-memory cache (hot, per session)

Distributed cache (Redis)

Local DB (Order/Trade tables)

Broker API (fallback / reconciliation)

Priority resolution is configurable.

3. Unified Settings Model
3.1 User-Centric Settings (Read Behavior)
{
  "orderReadPreferences": {
    "defaultTimeRangeDays": 1,
    "preferCache": true,
    "allowBrokerFallback": true,
    "maxRecordsPerRequest": 500,
    "timezone": "Asia/Kolkata",
    "redactCounterparty": true
  },
  "tradeReadPreferences": {
    "includeCharges": true,
    "includeSettlementStatus": true,
    "groupPartialFills": false
  }
}

3.2 Admin-Centric Settings (Governance)
{
  "readApiControls": {
    "cacheTtlSeconds": {
      "orderBook": 2,
      "orderHistory": 60,
      "tradeDay": 5,
      "tradeHistory": 3600
    },
    "rateLimits": {
      "perUserPerMinute": 120,
      "perIPPerMinute": 300
    },
    "brokerFallbackPolicy": "ON_CACHE_MISS",
    "auditLogLevel": "FULL",
    "historicalRetentionYears": 3
  }
}

4. API-Wise Enterprise Implementation
4.1 Get Order History
Purpose

Lifecycle trace of one order (state transitions).

Enterprise Enhancements

Immutable event log

Timestamp normalization

Exchange ↔ internal status mapping

Replay support

Internal Flow
Request → Cache(orderId)
    → DB(order_events)
        → Broker (only if missing)

Internal Entity
OrderEvent {
  orderId,
  state,
  filledQty,
  pendingQty,
  avgPrice,
  exchangeOrderId,
  eventTime,
  source (EXCHANGE|SYSTEM)
}

CLI
trader orders history --order-id 240108010445130

curl
curl -H "Authorization: Bearer $TOKEN" \
     "https://api.yourdomain.com/v3/orders/history?orderId=..."

4.2 Get Order Book
Purpose

Snapshot of all live + completed orders for the day

Enterprise Enhancements

Session-scoped cache

Status aggregation

Reject reason normalization

Cache Strategy

TTL: 2 seconds

Invalidate on order event

Response Augmentation

age_ms

last_update_source

is_final

React (Vite)
useQuery(["orderBook"], fetchOrderBook, {
  refetchInterval: 1000
});

4.3 Get Trades (Today)
Purpose

All executions today

Enterprise Enhancements

Partial fill expansion

Charge enrichment

Trade → Order linkage

Derived Fields

gross_value

net_value

charges_breakup

pnl_impact

DB Join
trades
  JOIN orders
  JOIN charges

4.4 Get Order Trades
Purpose

Trades for one order

Enterprise Enhancements

Deterministic ordering

VWAP recomputation

Exchange vs broker trade ID mapping

Internal Aggregation
OrderTradeSummary {
  totalFilledQty,
  vwap,
  tradeCount,
  firstFillTime,
  lastFillTime
}

4.5 Get Trade History (Multi-Year)
Purpose

Regulatory & reporting grade historical data

Enterprise Controls

Pagination enforced

Read-only replica DB

Export throttling

Mandatory Features

Segment filter

Date boundary validation

Regulator-safe formatting

CLI
trader trades history \
  --from 2024-04-01 \
  --to 2024-06-30 \
  --segment FO \
  --page 1 --size 100

5. Charges, Settlement & P&L Linkage
Trade → Settlement Mapping
TRADE → T+0
EQUITY → T+1
FO → T+0

Charges Stored Per Trade

Brokerage

Exchange fees

STT

GST

SEBI charges

Stamp duty

P&L Engine Hooks

Realized P&L (on trade)

Unrealized P&L (mark-to-market)

Net P&L (post charges)

6. Audit & Compliance
Mandatory Audit Fields

request_id

user_id

ip_address

data_source (CACHE|DB|BROKER)

response_hash

Export Formats

CSV (internal)

PDF (client)

Regulator pack (ZIP: CSV + checksum)

7. Performance Benchmarks (Indicative)
API	Cache	DB	Broker
Order Book	5–10 ms	40 ms	300+ ms
Order History	10 ms	60 ms	350 ms
Trades (Day)	15 ms	80 ms	400 ms
Trade History	—	120 ms	N/A
8. SEBI-Style Annexure Language (Excerpt)

“The system implements a multi-layered read architecture ensuring deterministic retrieval of order and trade information. All user-initiated queries are subject to role-based access control, rate governance, immutable audit logging, and data retention policies aligned with SEBI circulars on record keeping and post-trade transparency.”

9. Summary Table
API	Cache	Audit	Charges	P&L	Export
Order History	✔	✔	—	—	✔
Order Book	✔	✔	—	—	✔
Trades	✔	✔	✔	✔	✔
Order Trades	✔	✔	✔	✔	✔
Trade History	DB	✔	✔	✔	✔