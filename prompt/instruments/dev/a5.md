1. Database Choice & Implications (SQLite)

Since you are using SQLite:

What changes vs PostgreSQL

No native BOOLEAN → stored as INTEGER (0/1)

No ILIKE → use LIKE + COLLATE NOCASE

No concurrent writes → fine (BOD load only)

Excellent for reference/master data

This is a correct choice for instrument metadata.

2. Physical Database Location

Absolute / relative path

backend/java/vega-trader/database/vega_trade.db


JDBC URL

jdbc:sqlite:backend/java/vega-trader/database/vega_trade.db

3. SQLite Schema (Production-Correct)
3.1 Instrument Master Table
CREATE TABLE IF NOT EXISTS instrument_master (
    instrument_key        TEXT PRIMARY KEY,
    segment               TEXT NOT NULL,
    exchange              TEXT NOT NULL,
    instrument_type       TEXT NOT NULL,

    trading_symbol        TEXT NOT NULL,
    name                  TEXT,

    isin                  TEXT,
    underlying_key        TEXT,
    underlying_symbol     TEXT,
    underlying_type       TEXT,

    expiry                DATE,
    strike_price          REAL,

    lot_size              INTEGER NOT NULL,
    minimum_lot           INTEGER,
    freeze_quantity       INTEGER,

    tick_size             REAL,
    exchange_token        TEXT,

    weekly                INTEGER,
    security_type         TEXT,

    trading_date          DATE NOT NULL,
    created_at            DATETIME DEFAULT CURRENT_TIMESTAMP
);

Indexes (Critical for Search & Autocomplete)
CREATE INDEX IF NOT EXISTS idx_symbol_search
ON instrument_master (trading_symbol, segment, instrument_type);

CREATE INDEX IF NOT EXISTS idx_underlying
ON instrument_master (underlying_key);

CREATE INDEX IF NOT EXISTS idx_expiry
ON instrument_master (expiry);

3.2 Suspended Instruments
CREATE TABLE IF NOT EXISTS instrument_suspension (
    instrument_key TEXT PRIMARY KEY,
    trading_date   DATE NOT NULL
);

3.3 MIS Overlay
CREATE TABLE IF NOT EXISTS instrument_mis (
    instrument_key      TEXT PRIMARY KEY,
    intraday_margin     REAL,
    intraday_leverage   REAL
);

3.4 MTF Overlay
CREATE TABLE IF NOT EXISTS instrument_mtf (
    instrument_key TEXT PRIMARY KEY,
    mtf_enabled    INTEGER,
    mtf_bracket    REAL
);

4. Java JDBC Configuration
4.1 Plain JDBC (No Spring)
String url = "jdbc:sqlite:backend/java/vega-trader/database/vega_trade.db";
Connection conn = DriverManager.getConnection(url);


Ensure dependency:

<dependency>
  <groupId>org.xerial</groupId>
  <artifactId>sqlite-jdbc</artifactId>
  <version>3.45.1.0</version>
</dependency>

4.2 Spring Boot Configuration
application.yml
spring:
  datasource:
    url: jdbc:sqlite:backend/java/vega-trader/database/vega_trade.db
    driver-class-name: org.sqlite.JDBC
  jpa:
    database-platform: org.hibernate.community.dialect.SQLiteDialect
    hibernate:
      ddl-auto: none
    show-sql: false


Do NOT use ddl-auto=update for reference data.

5. Loader Adaptation for SQLite
SQLite-Safe Batch Insert Strategy

Batch size: 300–500

Explicit transaction

WAL mode recommended

connection.setAutoCommit(false);
statement.execute("PRAGMA journal_mode=WAL;");

Insert Pattern
PreparedStatement ps = conn.prepareStatement(INSERT_SQL);

for (Instrument i : batch) {
    ps.setString(1, i.getInstrumentKey());
    ...
    ps.addBatch();
}

ps.executeBatch();
conn.commit();

6. Search Query (SQLite-Compatible)
SELECT i.instrument_key,
       i.trading_symbol,
       i.segment,
       i.instrument_type,
       i.expiry,
       i.strike_price,
       m.mtf_enabled,
       mi.instrument_key IS NOT NULL AS mis_allowed,
       s.instrument_key IS NOT NULL AS suspended
FROM instrument_master i
LEFT JOIN instrument_mtf m ON i.instrument_key = m.instrument_key
LEFT JOIN instrument_mis mi ON i.instrument_key = mi.instrument_key
LEFT JOIN instrument_suspension s ON i.instrument_key = s.instrument_key
WHERE i.trading_symbol LIKE ? COLLATE NOCASE
AND i.segment = ?
AND i.instrument_type = ?;

7. Autocomplete Query (Fast Path)
SELECT instrument_key, trading_symbol, instrument_type
FROM instrument_master
WHERE trading_symbol LIKE ? || '%'
AND segment = 'NSE_EQ'
ORDER BY
  CASE WHEN trading_symbol = ? THEN 0 ELSE 1 END,
  trading_symbol
LIMIT 15;

8. Risk Engine Integration (SQLite Lookup)
Example Check
boolean isMISAllowed =
    jdbcTemplate.queryForObject(
        "SELECT COUNT(*) FROM instrument_mis WHERE instrument_key = ?",
        Integer.class,
        instrumentKey
    ) > 0;

9. Operational Rules (SQLite-Specific)

Load instruments once per day

Do not write during market hours

WAL mode always ON

Back up DB before reload

Never vacuum during trading hours

10. Final Directory Layout (Recommended)
backend/
└── java/
    └── vega-trader/
        ├── database/
        │   └── vega_trade.db
        ├── instrument-loader/
        ├── instrument-service/
        └── risk-engine/