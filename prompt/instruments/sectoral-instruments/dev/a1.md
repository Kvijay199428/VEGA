Below is a complete enterprise-grade feature upgrade guide for introducing Sectoral / Thematic / Index-based instrument classification and search, designed to fit cleanly into your existing Instruments + RMS + Multi-Broker architecture.

This is written so you can directly convert it into formal product + technical documentation.

Sectoral Indexing & Instrument Discovery – Enterprise Upgrade Guide
1. Feature Objective

Introduce a Sector / Index–aware Instrument Discovery Layer that allows:

Users to:

Browse instruments by Sector / Theme / Index

Search instruments using sector-based filters

System to:

Automatically ingest NSE index constituent CSVs

Auto-map instruments to sectors without manual tagging

Support future indices by configuration only (URL-driven)

Risk & RMS to:

Apply sector-level exposure caps

Enable sector-based trading restrictions in the future

2. High-Level Architecture
CSV Index Feeds (NiftyIndices)
        ↓
IndexConstituentLoader (Scheduled / CLI)
        ↓
Sector & Index Master Tables
        ↓
Instrument ↔ Index ↔ Sector Mapping
        ↓
Sectoral Search API + Autocomplete
        ↓
Frontend (Sector Filters)
        ↓
RMS / Risk Engine (Optional Controls)


This architecture is:

Additive (no breaking changes)

Config-driven

Auditable

3. Core Domain Model Extensions
3.1 New Domain Concepts
Concept	Description
Index	Logical grouping of instruments (e.g. Nifty IT)
Sector	Higher-level classification (IT, Banking, Healthcare)
Theme	Cross-sector grouping (EV, Energy, PSU, etc.)
Constituent	Instrument belonging to an Index
4. Database Schema (SQLite / Flyway-style)
4.1 Sector Master
CREATE TABLE sector_master (
  sector_code TEXT PRIMARY KEY,
  sector_name TEXT NOT NULL,
  category TEXT NOT NULL, -- SECTORAL / THEMATIC / BROAD
  active BOOLEAN DEFAULT 1,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);


Examples:

IT

BANKING

HEALTHCARE

ENERGY

4.2 Index Master
CREATE TABLE index_master (
  index_code TEXT PRIMARY KEY,
  index_name TEXT NOT NULL,
  sector_code TEXT,
  source_url TEXT NOT NULL,
  exchange TEXT DEFAULT 'NSE',
  active BOOLEAN DEFAULT 1,
  last_updated DATE,
  FOREIGN KEY (sector_code) REFERENCES sector_master(sector_code)
);


Examples:

NIFTY_IT → IT

NIFTY_BANK → BANKING

NIFTY_EV → THEMATIC

4.3 Index Constituents
CREATE TABLE index_constituent (
  index_code TEXT,
  instrument_key TEXT,
  symbol TEXT,
  series TEXT,
  isin TEXT,
  industry TEXT,
  weight REAL,
  PRIMARY KEY (index_code, instrument_key),
  FOREIGN KEY (index_code) REFERENCES index_master(index_code)
);

4.4 Instrument ↔ Sector View (Derived)

You do NOT duplicate instruments.
Instead, derive sector membership dynamically:

CREATE VIEW instrument_sector_view AS
SELECT DISTINCT
  ic.instrument_key,
  im.sector_code,
  sm.sector_name
FROM index_constituent ic
JOIN index_master im ON ic.index_code = im.index_code
JOIN sector_master sm ON im.sector_code = sm.sector_code;

5. CSV Ingestion & Auto-Mapping
5.1 Config-Driven Index Registry
indices:
  - indexCode: NIFTY_IT
    sector: IT
    url: https://www.niftyindices.com/IndexConstituent/ind_niftyitlist.csv

  - indexCode: NIFTY_BANK
    sector: BANKING
    url: https://www.niftyindices.com/IndexConstituent/ind_niftybanklist.csv


Adding new sectors or indices requires:

Adding one config entry

No code changes

5.2 IndexConstituentLoader (Java)

Responsibilities:

Download CSV

Parse rows

Resolve instrument_key

Upsert constituents

instrumentKey = exchange + "_EQ|" + symbol;


Validation:

Symbol must exist in instrument_master

Series must be EQ / BE / SME as per RMS rules

5.3 Scheduling

Daily T+1 refresh (post NSE publication)

Manual CLI override:

java -jar vega-trader.jar load-indices --all

6. Instrument Resolution & Search Enhancements
6.1 Search API Extensions
GET /api/instruments/search


New parameters:

Param	Example
sector	IT
index	NIFTY_IT
theme	EV
q	"bank"

Backend query strategy:

Symbol prefix → Index membership → Sector

6.2 Autocomplete Strategy (Enterprise)

Index these fields:

symbol

company_name

sector_name

index_name

Search ranking priority:

Exact symbol match

Sector match

Index match

Industry match

7. Frontend (Vite + React)
7.1 UI Enhancements

Sector dropdown

Index multiselect

Chips:

[IT] [Banking] [Nifty IT]

7.2 Autocomplete UX

Typing "it" returns:

Infosys

TCS

Nifty IT constituents

8. RMS & Risk Engine Extensions (Optional but Enterprise-Grade)
8.1 Sector-Level Exposure Caps
CREATE TABLE sector_risk_limit (
  sector_code TEXT PRIMARY KEY,
  max_exposure DECIMAL,
  max_open_positions INTEGER
);


Use cases:

Limit IT exposure to 40%

Block trading entire sector during surveillance

8.2 Sector-Based Kill Switch
if (sector.isBlocked()) {
  reject("SECTOR_BLOCKED");
}

9. Audit & Governance
Feature	Supported
Historical index composition	Yes
Reproducible trading state	Yes
Sector exposure reporting	Yes
Compliance audit	Yes
10. Testing Strategy
Unit Tests

CSV parsing

Instrument key resolution

Index → Sector mapping

Integration Tests

Search by sector

RMS rejection by sector

Regression

Instrument lookup unaffected

RMS unaffected when sector feature disabled

11. Why This Is Enterprise-Grade

Zero duplication of instruments

Fully config-driven

Extensible to:

ESG indices

Custom broker indices

Client-specific baskets

Compatible with:

Risk engines

Portfolio analytics

Quant screening

12. Future Enhancements (Roadmap)

Sector heatmaps

Sector-wise margin multipliers

AI-driven thematic tagging

Sector correlation risk models

Final Summary

Instrument data remains authoritative in Instrument Master.
Sectoral indexing is a derived, auditable classification layer built on top of trusted NSE index feeds.

This design:

Avoids data duplication

Enables powerful discovery

Strengthens RMS & compliance

Scales indefinitely